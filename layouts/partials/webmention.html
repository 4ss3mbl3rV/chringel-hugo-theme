{{ $mentions := (where (where (where .Site.Data.webmentions "relativeTarget" "==" $.RelPermalink) "content" "!=" "") "type" "!=" "like") }}
{{ $reactions := (where (where .Site.Data.webmentions "relativeTarget" "==" $.RelPermalink) "type" "!=" "mention") }}

{{ if $mentions }}
  <h4>Responses</h4>
  {{ range $mentions }}
    <article class="u-comment h-cite mb-5">
      <div>
        <a
          rel="author"
          class="u-author h-card u-url font-bold text-sm"
          href="{{ .url }}"
        >
          {{ $name := .author.name | safeHTML }}
          {{ if isset .author "picture" }}
            <div>
              <img
                class="u-photo mr-2 float-left w-8 h-8 rounded-full border border-gray-200"
                loading="lazy"
                src="{{ $.Site.Params.webmention.webmentionUrl }}{{ .author.picture | safeHTML }}"
                alt="{{ $name }}"
              />
            </div>
          {{ else }}
            <div>
              <img
                class="u-photo mr-2 float-left w-8 h-8 rounded-full border border-gray-200"
                loading="lazy"
                src="/img/anonymous-avatar.png"
                alt="{{ $name }} anonymous photo"
              />
            </div>
          {{ end }}
          {{ $name }}
        </a>
        ‚Ä¢
        <time class="dt-published text-sm" datetime="{{ .published }}">
          {{- $publishedAsDate := .published | time -}}
          {{ partial "reldate.html" $publishedAsDate }}
        </time>
      </div>
      <p class="p-content p-name text-sm">{{ .content | safeHTML }}</p>
    </article>
  {{ end }}
  <hr />
{{ end }}

{{ if $reactions }}
  <h4>Reactions</h4>
  <div class="flex flex-wrap">
    {{ $reactionIcon := "" }}
    {{ $reactionText := "" }}
    {{ range $reactions }}
      {{ if eq .type "like" }}
        {{ $reactionIcon = "‚ù§Ô∏è" }}
        {{ $reactionText = "liked" }}
      {{ else if eq .type "repost" }}
        {{ $reactionIcon = "üîÅ" }}
        {{ $recationText = "reposted" }}
      {{ else }}
        {{ $reactionIcon = "‚≠êÔ∏è" }}
        {{ $reactionText = "favorited" }}
      {{ end }}
      <a
        rel="author"
        class="u-author h-card u-url font-bold text-sm"
        href="{{ .url }}"
        title="{{ .author.name }} {{ $reactionText }}"
      >
        {{ $name := .author.name | safeHTML }}
        {{ if isset .author "picture" }}
          <div class="relative">
            <img
              class="u-photo mr-2 float-left w-8 h-8 rounded-full border border-gray-200"
              loading="lazy"
              src="{{ $.Site.Params.webmention.webmentionUrl }}{{ .author.picture | safeHTML }}"
              alt="{{ $name }}"
            />
            <span class="absolute right-0">{{ $reactionIcon }}</span>
          </div>
        {{ else }}
          <div class="relative">
            <img
              class="u-photo mr-2 float-left w-8 h-8 rounded-full border border-gray-200"
              loading="lazy"
              src="/img/anonymous-avatar.png"
              alt="{{ $name }} anonymous photo"
            />
            <span class="absolute right-0">{{ $reactionIcon }}</span>
          </div>
        {{ end }}
      </a>
    {{ end }}
  </div>
{{ end }}
